<?xml version="1.0" encoding="utf-8" ?>
<odoo>

    <!-- helpdesk tree view -->
    <record id="oak_helpdesk_ticket_tree_inherit" model="ir.ui.view">
        <field name="name">helpdesk.ticket.tree.inherit</field>
        <field name="model">helpdesk.ticket</field>
        <field name="priority">110</field>
        <field name="inherit_id" ref="helpdesk.helpdesk_tickets_view_tree" />
        <field name="arch" type="xml">
            <field name="activity_ids" position="after">
                <field name="ext_ref" optional="show" />
                <field name="incident_source" optional="hide" />
                <field name="incident_cause" optional="hide" />
                <field name="ref_saleorder" optional="hide" />
                <field name="ref_saleorder_legacy" optional="hide" />
            </field>
        </field>
    </record>

    <!-- helpdesk team form-->
     <record id="oak_helpdesk_team_view_form" model="ir.ui.view">
        <field name="name">oak.helpdesk.team.form</field>
        <field name="model">helpdesk.team</field>
        <field name="priority">100</field>
        <field name="inherit_id" ref="helpdesk.helpdesk_team_view_form" />
        <field name="arch" type="xml">
            <data>
                <xpath expr="//div[@id='after-sales']" position="after">
                    <h2>Customer Service</h2>
                    <div class="row mt32 o_settings_container" id="customer_care">
                        <div class="col-lg-6 o_setting_box">
                            <div class="o_setting_left_pane">
                                <field name="show_incident_fields" />
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="show_incident_fields" />
                                <div class="text-muted">
                                    Show Incidents Fields in New Tab
                                </div>
                            </div>
                        </div>
                    </div>
                </xpath>
            </data>
        </field>
    </record>

    <!-- helpdesk ticket form -->
    <record id="oak_helpdesk_ticket_form" model="ir.ui.view">
        <field name="name">oak.helpdesk.ticket.form</field>
        <field name="model">helpdesk.ticket</field>
        <field name="priority">100</field>
        <field name="inherit_id" ref="helpdesk.helpdesk_ticket_view_form" />
        <field name="arch" type="xml">
            <data>
                <xpath expr="//sheet" position="inside">
                    <field name="show_incident_fields" invisible="1" />
                    <notebook
                        attrs="{'invisible': [('show_incident_fields', '=', False)]}"
                    >
                        <page string="Case Incident Information">
                            <group>
                                <group>
                                    <field name="is_warranty" />
                                    <field name="ref_product" />
                                    <field name="ref_product_legacy" />
                                </group>
                                <group>
                                    <field name="ref_saleorder" />
                                    <field name="ref_saleorder_legacy" />
                                    <field name="incident_cause" />
                                    <field name="incident_source" />
                                </group>
                            </group>
                        </page>
                    </notebook>
                    <notebook
                        attrs="{'invisible': [('show_incident_fields', '=', False)]}"
                    >
                        <page string="Case Items">
                            <field
                                name="case_item_ids"
                                nolabel="1"
                                widget="one2many_list"
                                context="{}"
                            >
                                <tree editable="top">
                                    <field name="ref_default_code" />
                                    <field name="ref_product" />
                                    <field name="ref_legacy" />
                                    <field name="description" />
                                    <field name="quantity" />
                                    <field name="to_be_ordered" />
                                    <field name="restocking_fee" />
                                    <field name="to_be_returned" />
                                    <field name="return_reason" />
                                    <field name="date_returned" widget="date" />
                                    <field name="notes" />
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </xpath>
                <field name="email_cc" position="replace">
                    <field name="email_cc" />
                    <field
                        name="ext_ref"
                        attrs="{'invisible': [('ext_ref', '=', False)]}"
                    />
                </field>
            </data>
        </field>
    </record>

    <!-- helpdesk ticket search incident items extension-->
    <record id="oak_helpdesk_tickets_view_search_case_items" model="ir.ui.view">
        <field name="name">helpdesk.ticket.oak.search</field>
        <field name="model">helpdesk.ticket</field>
        <field name="priority">100</field>
        <field name="inherit_id" ref="oak_helpdesk.oak_helpdesk_tickets_view_search" />
        <field name="arch" type="xml">
            <xpath expr="//field[@name='message_ids']" position="after">
                <field
                    name="case_item_ids"
                    string="Case Item Product Number"
                    filter_domain="[('case_item_ids.ref_default_code','ilike',self)]"
                />
                <field
                    name="case_item_ids"
                    string="Case Item Product Name"
                    filter_domain="[('case_item_ids.description','ilike',self)]"
                />
                <field
                    name="case_item_ids"
                    string="Case Item Notes"
                    filter_domain="[('case_item_ids.notes','ilike',self)]"
                />
            </xpath>
        </field>
    </record>

</odoo>
