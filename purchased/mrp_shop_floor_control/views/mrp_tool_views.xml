<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <!-- Tags -->
    <record model="ir.ui.view" id="mrp_tool_tags_tree_view">
        <field name="name">mrp_tool_tags_tree_view</field>
        <field name="model">mrp.tool.tags</field>
        <field name="arch" type="xml">
            <tree string="Tool Tags" editable="top">
                <field name="name" />
                <field name="color" widget="color_picker" optional="show" />
            </tree>
        </field>
    </record>

    <record model="ir.ui.view" id="mrp_tool_tags_form_view">
        <field name="name">mrp_tool_tags_form_view</field>
        <field name="model">mrp.tool.tags</field>
        <field name="arch" type="xml">
            <form string="Tool Tags">
                <sheet>
                    <group>
                        <field name="name" />
                        <field name="color" widget="color_picker" />
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record model="ir.ui.view" id="mrp_tool_tags_search_view">
        <field name="name">mrp_tool_tags_search_view</field>
        <field name="model">mrp.tool.tags</field>
        <field name="arch" type="xml">
            <search>
                <field name="name" />
            </search>
        </field>
    </record>

    <record id="mrp_tool_tags_action" model="ir.actions.act_window">
        <field name="name">Tool Tags</field>
        <field name="res_model">mrp.tool.tags</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
            No tags found. Let's create one!
            </p>
            <p>
                Use tags to categorize your tools.
            </p>
        </field>
    </record>

    <menuitem
        action="mrp_tool_tags_action"
        id="menu_mrp_tool_tags"
        parent="mrp.menu_mrp_configuration"
        sequence="100"
    />

    <!-- Tools views -->
    <record id="mrp_tool_tree_view" model="ir.ui.view">
        <field name="name">mrp.tool.tree</field>
        <field name="model">mrp.tool</field>
        <field name="arch" type="xml">
            <tree string="Production Tools" multi_edit="1">
                <field name="tool_number" />
                <field name="name" />
                <field
                    name="tag_ids"
                    widget="many2many_tags"
                    options="{'color_field': 'color'}"
                />
                <field name="activity_ids" widget="list_activity" />
                <field name="currency_id" invisible="1" />
                <field
                    name="date_next_calibration"
                    readonly="1"
                    widget="remaining_days"
                />
                <field name="production_id" readonly="True" />
                <field
                    name="tag_ids"
                    widget="many2many_tags"
                    options="{'color_field': 'color'}"
                    optional="hide"
                />
                <field name="active" optional="hide" />
                <button
                    name="unallocating_tool"
                    string="Unallocated"
                    type="object"
                    class="oe_highlight"
                    attrs="{'invisible': [('production_id', '=', False)]}"
                />
            </tree>
        </field>
    </record>

    <record id="mrp_tool_form_view" model="ir.ui.view">
        <field name="name">mrp.tool.form</field>
        <field name="model">mrp.tool</field>
        <field name="arch" type="xml">
            <form string="Production Tools">
                <header>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button
                            class="oe_stat_button"
                            name="attachment_tree_view"
                            type="object"
                            icon="fa-files-o"
                        >
                            <field
                                string="Documents"
                                name="doc_count"
                                widget="statinfo"
                            />
                        </button>
                    </div>
                    <widget
                        name="web_ribbon"
                        text="Archived"
                        bg_color="bg-danger"
                        attrs="{'invisible': [('active', '=', True)]}"
                    />
                    <field
                        name="image_1920"
                        widget="image"
                        class="oe_avatar"
                        nolabel="1"
                        options="{'preview_image': 'image_128'}"
                    />
                    <div class="oe_title">
                        <label for="name" string="Production Tool" />
                        <field name="active" invisible="1" />
                        <h1><field name="name" /></h1>
                    </div>
                    <group>
                        <group>
                            <field name="tool_number" required="True" />
                            <field name="model" />
                            <field name="serial" />
                            <field
                                name="tag_ids"
                                widget="many2many_tags"
                                options="{'color_field': 'color'}"
                            />
                        </group>
                        <group>
                            <field name="date_next_calibration" widget="date" />
                            <field name="asset_id" />
                            <field
                                name="purchase_value"
                                widget="monetary"
                                options="{'currency_field': 'currency_id'}"
                            />
                            <field name="currency_id" invisible="1" />
                            <field
                                name="company_id"
                                groups="base.group_multi_company"
                                options="{'no_open':True,'no_create':True}"
                            />
                        </group>
                    </group>
                    <notebook>
                        <page name="Warranty" string="Warranty">
                            <group>
                                <group>
                                    <field
                                        name="manufacturer_id"
                                        placeholder="Name, TIN, Email, or Reference"
                                    />
                                    <label
                                        for="warranty_start_date"
                                        string="Warranty Validity Period"
                                    />
                                        <div>
                                            <field
                                            name="warranty_start_date"
                                            class="oe_inline"
                                        /> -
                                            <field
                                            name="warranty_end_date"
                                            class="oe_inline"
                                            nolabel="1"
                                        />
                                        </div>
                                </group>
                                <group>
                                    <field
                                        name="vendor_id"
                                        widget="res_partner_many2one"
                                        placeholder="Name, TIN, Email, or Reference"
                                    />
                                    <field name="purchase_date" />
                                </group>
                            </group>
                        </page>
                        <page name="info" string="Info">
                            <group string="Tool Technical Notes">
                                <field name="note" colspan="4" nolabel="1" />
                            </group>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field
                        name="message_follower_ids"
                        widget="mail_followers"
                        groups="base.group_user"
                    />
                    <field name="activity_ids" widget="mail_activity" />
                    <field name="message_ids" widget="mail_thread" />
                </div>
            </form>
        </field>
    </record>

    <record id="mrp_tool_kanban_view" model="ir.ui.view">
        <field name="name">mrp.tool.kanban</field>
        <field name="model">mrp.tool</field>
        <field name="arch" type="xml">
            <kanban>
                <field name="id" />
                <field name="name" />
                <field name="message_needaction_counter" />
                <field name="activity_ids" />
                <field name="activity_state" />
                <field name="date_next_calibration" />
                <field name="image_128" />
                <field name="tag_ids" />
                <templates>
                    <t t-name="kanban-box">
                        <div
                            class="oe_kanban_global_click o_kanban_record_has_image_fill"
                        >
                            <field
                                name="image_128"
                                widget="image"
                                class="o_kanban_image_fill_left"
                                options="{'zoom': true, 'zoom_delay': 1000, 'background': true, 'preventClicks': false}"
                            />
                            <div class="oe_kanban_details">
                                <div class="o_kanban_record_top">
                                    <div class="o_kanban_record_headings">
                                        <strong class="o_kanban_record_title"><field
                                                name="name"
                                            /></strong><br />
                                    </div>
                                    <t
                                        t-if="record.date_next_calibration.raw_value and record.date_next_calibration.raw_value lt (new Date())"
                                        t-set="red"
                                    >oe_kanban_text_red</t>
                                    <span t-attf-class="#{red || ''}"><i><field
                                                name="date_next_calibration"
                                                widget="date"
                                            /></i></span>
                                </div>
                                <div class="o_kanban_record_body">
                                    <div>
                                        <field name="tool_number" />
                                    </div>
                                    <div>
                                        <field name="model" />
                                        <field name="serial" />
                                    </div>
                                    <div>
                                        <field
                                            name="tag_ids"
                                            widget="many2many_tags"
                                            options="{'color_field': 'color'}"
                                        />
                                    </div>
                                </div>
                                <div class="o_kanban_record_bottom">
                                    <div class="oe_kanban_bottom_left">
                                        <field
                                            name="activity_ids"
                                            widget="kanban_activity"
                                        />
                                        <t
                                            t-if="record.message_needaction_counter.raw_value"
                                        >
                                            <span
                                                role="alert"
                                                class="oe_kanban_mail_new"
                                                title="Unread Messages"
                                            ><i
                                                    class="fa fa-comments"
                                                    role="img"
                                                    aria-label="Unread Messages"
                                                /><t
                                                    t-raw="record.message_needaction_counter.raw_value"
                                                /></span>
                                        </t>
                                    </div>
                                </div>
                                <div class="oe_clear" />
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <record id="mrp_tool_search_view" model="ir.ui.view">
        <field name="name">mrp.tool.search</field>
        <field name="model">mrp.tool</field>
        <field name="arch" type="xml">
            <search string="Production Tool Search">
                <field name="name" />
                <field name="production_id" />
                <field name="tag_ids" />
                <filter
                    name="filter_date_next_calibration"
                    string="Next Calibration Date"
                    date="date_next_calibration"
                />
               <separator />
                <filter
                    string="Archived"
                    name="inactive"
                    domain="[('active','=',False)]"
                />
                <separator />
                <filter
                    string="Late Activities"
                    name="activities_overdue"
                    domain="[('my_activity_date_deadline', '&lt;', context_today().strftime('%Y-%m-%d'))]"
                    help="Show all records which has next action date is before today"
                />
                <filter
                    string="Today Activities"
                    name="activities_today"
                    domain="[('my_activity_date_deadline', '=', context_today().strftime('%Y-%m-%d'))]"
                />
                <filter
                    string="Future Activities"
                    name="activities_upcoming_all"
                    domain="[('my_activity_date_deadline', '&gt;', context_today().strftime('%Y-%m-%d'))]"
                />
                <searchpanel>
                    <field
                        name="tag_ids"
                        select="multi"
                        icon="fa-tag"
                        enable_counters="1"
                    />
                </searchpanel>
            </search>
        </field>
    </record>

    <record id="action_mrp_tools" model="ir.actions.act_window">
        <field name="name">Tools</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">mrp.tool</field>
        <field name="view_mode">kanban,tree,form,activity</field>
    </record>

    <menuitem
        id="menu_view_mrp_tool"
        action="action_mrp_tools"
        groups="mrp.group_mrp_manager"
        parent="mrp.menu_mrp_bom"
        sequence="20"
    />>
</odoo>
